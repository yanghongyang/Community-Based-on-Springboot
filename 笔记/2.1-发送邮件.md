#### 邮箱设置

- 启用客户端SMTP服务
  - 在自己设置的邮箱 `A` 下点击设置，并启用 `SMTP` 服务

#### Spring Email

- 导入 `jar` 包

  - 在 [https://mvnrepository.com/](https://mvnrepository.com/) 下搜索 `spring mail` 

  - 选择[Spring Boot Starter Mail](https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-mail) ，并选择版本

  - 在弹出的页面上复制 `xml` 代码，并将代码复制到项目的 `pom.xml` 文件下，之后更新 `pox.xml` （文件右上方有一个同步按钮），`xml` 代码未显示报错，即导入成功

    - ```xml
      <!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-mail -->
      <dependency>
          <groupId>org.springframework.boot</groupId>
          <artifactId>spring-boot-starter-mail</artifactId>
          <version>2.4.1</version>
      </dependency>
      ```

- 邮箱参数配置

  - ```xml
    # 邮箱配置
    spring.mail.host=smtp.163.com
    spring.mail.port=465
    spring.mail.username=填自己配置好的邮箱的用户名
    spring.mail.password=填自己配置好的邮箱的密码（准确的说应该是密码）
    # mail服务使用的协议：smtp ，加s表示安全传输，但是加了的话会报错，因此这里还是写smtp
    spring.mail.protocol=smtp
    # mail服务启用smtp的ssl连接（安全性）
    spring.mail.properties.mail.smtp.ssl.enable=true
    ```

  

- 使用 `JavaMailSender` 发送邮件

  - 在 `src->main->java->com.xxxx.community` 下新建一个包 `util` ，专门用来提供类似发邮件这样的服务
  
  - `JavaMailSender` 只有两种方法， `createMimeMessage` 和 `send` 
  
  - 在实现的时候，需要设置 `helper` 来设置发送方、内容、主题等
  
    ```Java
    @Autowired
    private JavaMailSender mailSender;
    
    // 发邮件的人，${spring.mail.username}是在application.properties中设置好了的
    @Value("${spring.mail.username}")
    private String from;
    
    //发邮件方法，参数为：收件人to，主题subject，内容content
    public void sendMail(String to, String subject, String content) {
        try{
            MimeMessage message = mailSender.createMimeMessage();  //createMimeMessage()只提供创建邮件的模板，不负责实现
            MimeMessageHelper helper = new MimeMessageHelper(message);  //MimeMessageHelper是用来帮助构建邮件内容的
            helper.setFrom(from);
            helper.setTo(to);
            helper.setSubject(subject);
            //如果setText方法不加第二个参数，则默认为普通文本，加了true，说明邮件可以识别html文本
            helper.setText(content, true);
            mailSender.send(helper.getMimeMessage());
        } catch (MessagingException e)
        {
            logger.error("发送邮件失败： " + e.getMessage());
        }
    }
    ```
  
    

#### 模板引擎

- 使用 `Thymeleaf` 发送 `HTML` 邮件

  - 在 `template` 模板目录下创建 `HTML` 模板，并在想要填充内容的地方用 `th:...` 标签确定

    ```html
    <!DOCTYPE html>
    <html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>邮件示例</title>
    </head>
    <body>
        <p>欢迎你，<span style="color:red;" th:text="${username}"></span>!</p>
    </body>
    </html>
    ```

  - 接着使用 `@Autowired` 自动注入 `TemplateEngine` ，这是模板引擎，可以用于生成模板。

    ```java
    @Autowired
    private TemplateEngine templateEngine;
    @Test
    public void testHTMLMail()
    {
        //设置传参的对象
        Context context = new Context();
        context.setVariable("username", "asdf");
        //使用templateEngine，按照template/mail/demo.html模板生成html邮件
        String content = templateEngine.process("/mail/demo", context);
        System.out.println(content);
    
        mailClient.sendMail("goodbookcommunity@163.com", "HTMLTest", content);
    }
    ```

  - 然后调用 `mailClient.sendMail` 方法就可以发送邮件了。