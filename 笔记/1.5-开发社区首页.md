### 开发社区首页

- 开发流程
  - 1次请求的执行过程
    - 请求会提交给服务器的视图层，Controller处理请求的过程中会访问业务层（Service），让业务组件处理相关业务，业务组件可能会访问DAO层来实现相关功能。
    - 依赖顺序为Controller -> Service -> DAO。按照以来的顺序来开发比较方便，因此先开发DAO层。
- 分步骤实现
  - 开发社区首页，显示前10个帖子
  - 开发分页组件，分页显示所有的帖子



- 开发细节

  1. 首先得再entity文件下创建相应表的java，以对表的数据进行封装

  2. 通常情况下，1张表开发一个Mapper接口，别忘记打上@Mapper注解，只有这样才能被容器扫描到相应的接口

  3. 想要分页，因此需要有两个参数：起始行号、每页多少行。

  4. @Param来起别名，方便写。其次，如果需要动态拼接sql（在“< if >”中使用），并且方法有且只有1个参数，则必须起别名。

  5. .xml文件可以自动解析List等Java自带的结构，所以如果返回类型是List<DiscussPost>则只需要写成 resultType="DiscussPost" 即可。
  
6. .xml 文件中使用<if> 标签来进行判断
  
7. 如何把userId和对应的User/username建立映射关系？
  
   - 第一种方式：在Mysql中直接建立userId和username的外键
     - 第二种方式：在java的service层增加查询方法，并把查到的username加到想要加的地方。——>好处：使用Redis缓存的时候可以提高性能。

  8. html文件下引入 `thymeleaf`，保存的时候引入的代码消失。
  
     - 处理办法：在`settings->plugins`下，下载`JBLHtmlToThymeleaf`插件，然后应用。安装好之后右击HTML文件，选择 `JBLHtmlToThymeleaf` 选项。

  9. 在HTML文件（已经使用 `Thymeleaf` 模板，即，在 `template` 目录而不是`static` 目录）中，引入静态（本地相对路径，类似 `<script src="js/global.js"></script>`）文件（而不是绝对路径，类似`<script src="https://code.jquery.com/jquery-3.3.1.min.js" crossorigin="anonymous"></script>`）时，使用以下代码

     - ```html
     <link rel="stylesheet" th:href="@{/css/global.css}">
       ```

     - 注意这里的 `th:href` 的格式， `"@{/css/global.css}"` 意为引用 `static` 目录下 `css` 文件下的 `global.css` 文件。

     - 也就是只需要在 `href` 或者 `src` 标签前添上 `th:` ，然后再将相对路径 `"xxxxx"` 改成 `"@{xxxxx}"` 即可。
  
  10. HTML文件的动态数据展示
  
     - 把原先写的静态数据删掉，留下模板内容。如：
  
     - ```html
       <li class="media pb-3 pt-3 mb-3 border-bottom">
           <a href="site/profile.html">
               <img src="http://images.nowcoder.com/head/1t.png" class="mr-4 rounded-circle" alt="用户头像"
                    style="width:50px;height:50px;">
           </a>
           <div class="media-body">
               <h6 class="mt-0 mb-3">
                   <a href="site/discuss-detail.html">备战春招，面试刷题跟他复习，一个月全搞定！</a>
                   <span class="badge badge-secondary bg-primary">置顶</span>
                   <span class="badge badge-secondary bg-danger">精华</span>
               </h6>
               <div class="text-muted font-size-12">
                   <u class="mr-3">寒江雪</u> 发布于 <b>2019-04-15 15:32:18</b>
                   <ul class="d-inline float-right">
                       <li class="d-inline ml-2">赞 11</li>
                       <li class="d-inline ml-2">|</li>
                     <li class="d-inline ml-2">回帖 7</li>
                   </ul>
             </div>
           </div>
       </li>
       ```

     - 想要对<li>标签进行动态数据展示，只需要把<li>标签改成下列形式。添加 `th:each` ，并且声明每次遍历从 `discussPosts` 中选取，选取的类型为 `map` 类型。

     - ```html
       <li class="media pb-3 pt-3 mb-3 border-bottom" th:each="map:${discussPosts}">
       ```

  11. 想暂时留个 `href` 待开发，可以写 

      - ```html
      <a href="#"> xxxxxxxxx </a>
        ```

  12. `th:text="$map.post.title"` 等类似语句中，`map.post.title` 相当于 `map.get("post")`  得到了 `post` 对象，然后 `post` 又访问了 `post.getTitle()` 方法。
  
  13. `th:text` 还可以写作 `th:utext` 。两者的区别在于： `th:text` 按照最原始的方式显示文本，而 `th:utext` 可以把转义字符进行转义之后再显示。比如说 `&lt` 的话，`th:text` 就会显示 `&lt` ，而 `th:utext` 会显示 `<`。

  14. `thymeleaf` 判断语法： `th:if` 。

      - ```html
      <span class="badge badge-secondary bg-primary" th:if="${map.post.type==1}">置顶</span>
        ```

      - 如果 `map` 中的 `post` 对象的 `gettype()` 方法返回的值为 `1` ，则显示 `<span>` 否则就不显示 `<span>` 。
  
  15. `thymeleaf` 对日期进行格式化：`th:text="${#dates.format(map.post.createTime, 'yyyy-MM-dd HH:mm:ss')}"` 。其中 `#dates.format(xxx, format)` 为语法。
  
  16. 使用 `Bootstrap` 和 `jQuery` 系列组件的时候，会因为网络问题导致页面的布局不对。这个时候需要使用国内稳定的 `CDN` ，具体操作见 [菜鸟教程（BootStrap4 安装使用）](https://www.runoob.com/bootstrap4/bootstrap4-install.html)
  
      > # Bootstrap4 安装使用
      >
      > 我们可以通过以下两种方式来安装 Bootstrap4：
      >
      > - 使用 Bootstrap 4 CDN。
      > - 从官网 [getbootstrap.com](https://getbootstrap.com/docs/4.1/getting-started/download/) 下载 Bootstrap 4。
      >
      > ### Bootstrap 4 CDN
      >
      > 国内推荐使用 Staticfile CDN 上的库：
      >
      > ```javascript
      > <!-- 新 Bootstrap4 核心 CSS 文件 -->
      > <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
      >  
      > <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
      > <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
      >  
      > <!-- bootstrap.bundle.min.js 用于弹窗、提示、下拉菜单，包含了 popper.min.js -->
      > <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
      >  
      > <!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
      > <script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
      > ```
      >
      > **注意：** *popper.min.js 用于设置弹窗、提示、下拉菜单，目前 bootstrap.bundle.min.js 已经包含了* [popper.min.js](https://github.com/FezVrasta/popper.js)*。*
      >
      > 此外，你还可以使用以下的 CDN 服务：
      >
      > - 国内推荐使用 : https://www.staticfile.org/
      > - 国际推荐使用：https://cdnjs.com/
      >
      > ### 下载 Bootstrap 4
      >
      > 你可以去官网 https://getbootstrap.com/ 下载 Bootstrap4 资源库。
      >
      > > **注：**此外你还可以通过包的管理工具 npm、 gem、 composer 等来安装：
    > >
      > > ```bash
    > > npm install bootstrap@4.0.0-beta.2
      > > gem 'bootstrap', '~> 4.0.0.beta2'
    > > composer require twbs/bootstrap:4.0.0-beta.2
      > > ```
  
  17. `th:href="@{${page.path}(current=1)}"` 这样写的话，可以将 `current=1` 自动转化为`url` :  `page.path?current=1` 。

  18. 想要实现从第几页到第几页的功能，可以使用 `thymeleaf` 中的 `#numbers.sequence(from, to)` 方法。案例如下：

      - ```html
      <li class="page-item active" th:each="${#numbers.sequence(page.from, page.to)}">
        ```
  
    - 由于在 `#numbers.sequence` 外已经使用了取数值符号 `$` ，因此在 `#numbers.sequence` 方法内可以直接写参数 `page.from` 和 `page.to` ，而不用加 `$` 。
  
19. 分页需要考虑的细节为：
  
      - 如果当前为首页，则不能点上一页；如果当前为最末页，则不能点下一页( `disabled` )
      - 除此之外，当前第几页，该页号需要被显示激活( `active` )

  20. `thymeleaf` 动态添加 `class` 样式

      - ```html
        <li th:class="|page-item ${page.current==page.getTotal}?'active':''|"> 
        ```
  
      - 这样写是因为 `page-item` 是静态数据，因此需要在 `th:class=""` 的 `""` 内添加 `|...|` ，在 `|...|` 内部写 `class` 名，之后如果想要添加字符串，则使用判断语句和三目运算符来进行添加。
  
  21. 

